---
import qs from "qs";
import Layout from "../../layouts/Layout.astro";
import SingleBlogItem from "../../components/SingleBlogItem.astro";

export async function getStaticPaths() {
  let url = import.meta.env.STRAPI_URL + "/api/posts";

  const query = qs.stringify({
    populate: {
      featuredImage: {
        fields: ["name", "width", "height", "url"],
      },
      author: {
        populate: {
          bioImage: {
            fields: ["name", "width", "height", "url"],
          },
        },
      },
      category: {
        populate: true,
      },
    },
  });

  const response = await fetch(url + "?" + query);
  const data = await response.json();

  // Check if data is an array before mapping over it
  const paths = Array.isArray(data)
    ? data.map((post) => ({
        params: { slug: post.attributes.slug },
      }))
    : [];

  return { paths, fallback: false };
}

export async function getStaticProps({ params }) {
  const url = `${import.meta.env.STRAPI_URL}/api/posts?slug=${params.slug}`;

